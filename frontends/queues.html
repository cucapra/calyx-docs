<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Queues - Calyx Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-7bb61c73.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-ed8c4c3b.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Calyx Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="queues"><a class="header" href="#queues">Queues</a></h1>
<p>A queue is a standard data structure that maintains a set of elements in some total order.
A new element is added to the queue using the <code>enqueue</code> operation, which is also known as <code>push</code> or <code>insert</code> in some contexts.
Because of the total order, some element of the queue is the <em>most favorably ranked</em> element.
We can remove this element from the queue using the <code>dequeue</code> operation, which is also known as <code>pop</code> or <code>remove</code> in some contexts.</p>
<p>We provision four types of queues in Calyx. The first three follow the same shared interface, while the fourth follows a slightly extended interface.
The frontend is implemented using the <a href="../builder/calyx-py.html">Calyx builder library</a>, and the source code is heavily commented.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<ol>
<li>Install <a href="https://flit.readthedocs.io/en/latest/#install">flit</a></li>
<li>Install the <code>queues</code> package:</li>
</ol>
<pre><code>    $ cd frontends/queues/
    $ flit install --symlink
</code></pre>
<h2 id="shared-interface"><a class="header" href="#shared-interface">Shared Interface</a></h2>
<p>All queues in Calyx expose the same interface.</p>
<ul>
<li>Input port <code>cmd</code>, a 2-bit integer.
Selects the operation to perform:
<ul>
<li><code>0</code>: <code>pop</code>.</li>
<li><code>1</code>: <code>push</code>.</li>
</ul>
</li>
<li>Input port <code>value</code>, a 32-bit integer.
The value to push.</li>
<li>Register <code>ans</code>, a 32-bit integer that is passed to the queue by reference.
If <code>pop</code> is selected, the queue writes the result to this register.</li>
<li>Register <code>err</code>, a 1-bit integer that is passed to the queue by reference.
The queue raises this flag in case of overflow or underflow.</li>
</ul>
<h2 id="shared-testing-harness"><a class="header" href="#shared-testing-harness">Shared Testing Harness</a></h2>
<p>Because they expose a common interface, we can test all queues using the same harness.</p>
<h4 id="data-generation"><a class="header" href="#data-generation">Data Generation</a></h4>
<p>First, we have a Python module that generates randomized sequences of operations and values, and dumps the sequences out in a Calyx <code>.data</code> file.
It accepts as a command line argument the number of operations to generate.
It also takes a flag, <code>--no-err</code>, that generates a special sequence of operations that does not trigger any overflow or underflow errors.
If this flag is provided, the queue’s length must also be provided.
The Python code is in <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/test_data_gen/gen_oracle_data.py"><code>gen_oracle_data.py</code></a>.</p>
<h4 id="oracles"><a class="header" href="#oracles">Oracles</a></h4>
<p>Next, we have a Python module <em>for each kind of queue</em> that reads the <code>.data</code> file, simulates the queue in Python, and dumps the expected result out in a Calyx <code>.expect</code> file.
This Python code is aware of our <a href="#shared-interface">shared interface</a>.
The oracles are in <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/test_data_gen/fifo_oracle.py"><code>fifo_oracle.py</code></a>, <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/test_data_gen/pifo_oracle.py"><code>pifo_oracle.py</code></a>, <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/test_data_gen/pifo_tree_oracle.py"><code>pifo_tree_oracle.py</code></a>, and <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/test_data_gen/binheap_oracle.py"><code>binheap_oracle.py</code></a>.
They all appeal to pure-Python implementations of the queues, which are found in <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/test_data_gen/queues.py"><code>queues.py</code></a>.
Each oracle also requires, as command line arguments, the number of operations being simulated and the queue’s length.</p>
<h4 id="queue-call"><a class="header" href="#queue-call">Queue Call</a></h4>
<p>The steps above lay out <code>.data</code> and <code>.expect</code> files for our Calyx code.
To actually pass a series of commands to a given eDSL queue implementation, we need to call the queue repeatedly with memories parsed from the <code>.data</code> file.
Unlike the above, which happens at the pure Python level, this needs to happen at the eDSL level.</p>
<p>This is exactly what <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/queues/queue_call.py"><code>queue_call.py</code></a> does.
It accepts as a Python-level argument a handle to the queue component that is to be tested.
It inserts a <code>main</code> component that reads the <code>.data</code> file and calls the queue component repeatedly.
If a command-line flag, <code>--keepgoing</code>, is provided, the <code>main</code> component will ignore any overflow or underflow errors raised by the queue component and will complete the entire sequence of operations.
If not, the <code>main</code> component will stop after the queue component first raises an error.</p>
<h4 id="putting-it-all-together"><a class="header" href="#putting-it-all-together">Putting It All Together</a></h4>
<p>The testing harness can be executed, for all our queues, by running the shell script <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/test_data_gen/gen_test_data.sh"><code>gen_test_data.sh</code></a>.
This generates the <code>.data</code> and <code>.expect</code> files for each queue.</p>
<p>Then, each queue can be tested using our <code>runt</code> setup.
The queue-generating Python files themselves expect command-line arguments (the number of operations and the optional <code>--keepgoing</code> flag) and you can see these being passed in the <a href="https://github.com/calyxir/calyx/blob/8221fe35c4a5bd9279547452c16bf29550396a03/runt.toml#L109-L127">relevant <code>runt</code> stanza</a>.</p>
<h2 id="fifo"><a class="header" href="#fifo">FIFO</a></h2>
<p>The most basic queue is the <em>first in, first out</em> (FIFO) queue: the most favorably ranked element is just the one that was added to the queue first.</p>
<p>Our queue frontend generates a simple FIFO in Calyx.
The source code is available <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/queues/fifo.py">here</a>.</p>
<p>Internally, our FIFO queue is implemented as a circular buffer.
One register marks the next element that would be popped, another marks the next cell into which an element would be pushed, and a third marks the number of elements in the queue.
The control logic is straightforward, and proceeds in three parallel arms based on the operation requested.</p>
<p>Using a circular buffer usually entails incrementing indices modulo the buffer size.
We use a trick to avoid this: we require the FIFO’s length to be a power of two, say <code>2^k</code>, and we use adders of width <code>k</code> to increment the indices.
This means we can just naively increment the indices forever and the wrap-around behavior we want is automatically provided by overflow.</p>
<h2 id="specialized-pifos"><a class="header" href="#specialized-pifos">Specialized PIFOs</a></h2>
<p>A more complex instance is the priority queue.
At time of enqueue, an element is associated with a priority.
The most favorably ranked element is the one with the highest priority.
Two elements may be pushed with the same priority; a priority queue that is additionally defined to break such ties in FIFO order is called a <em>push in, first out</em> (PIFO) queue.</p>
<p>We provide PIFOs in the general sense (i.e., queues that accept <code>(item, rank)</code> pairs and enqueue based on <code>rank</code>) <a href="#minimum-binary-heap">shortly</a>. For now, let’s focus on specialized PIFOs that have a policy “baked in” to the queue itself.</p>
<p>We have two types of specialized PIFOs - Round Robin and Strict - that implement policies which determine which flow to pop from next. These PIFOs are parameterized over the number of flows, <code>n</code>, that they can arbitrate between.</p>
<h3 id="round-robin-queues"><a class="header" href="#round-robin-queues">Round-Robin Queues</a></h3>
<p>Round robin queues are PIFOs generalized to <code>n</code> flows that operate in a work
conserving round-robin fashion. That is, if a flow is silent when it is its turn, that flow
simply skips its turn and the next flow is offered service.</p>
<p>Internally, it operates <code>n</code> subqueues.
It takes in a list <code>boundaries</code> that must be of length <code>n</code>, using which the
client can divide the incoming traffic into <code>n</code> flows.
For example, if <code>n = 3</code> and the client passes boundaries <code>[133, 266, 400]</code>,
packets will be divided into three flows according to the intervals: <code>[0, 133]</code>, <code>[134, 266]</code>, <code>[267, 400]</code>.</p>
<ul>
<li>At <code>push</code>, we check the <code>boundaries</code> list to determine which flow to push to.
Take the boundaries example given earlier, <code>[133, 266, 400]</code>.
If we push the value <code>89</code>, it will, under the hood, be pushed into subqueue 0 because <code>0 &lt;= 89 &lt;= 133</code>,
and <code>305</code> will be pushed into subqueue 2 since <code>266 &lt;= 305 &lt;= 400</code>.</li>
<li>The program maintains a <code>hot</code> pointer that starts off at 0, meaning the next subqueue to pop from is queue 0.
At <code>pop</code> we first try to pop from <code>hot</code>. If this succeeds, great. If it fails,
we increment <code>hot</code> and therefore continue to check all other flows
in round robin fashion.</li>
</ul>
<p>The source code is available in <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/queues/strict_or_rr.py"><code>strict_or_rr.py</code></a>, which takes as arguments <code>n</code>, <code>boundaries</code>, and handles to the subqueues it must administer. It also takes a boolean parameter <code>round_robin</code>, which, if <code>true</code>, results in the generation of a round-robin queue.</p>
<h3 id="strict-queues"><a class="header" href="#strict-queues">Strict Queues</a></h3>
<p>Strict queues support <code>n</code> flows as well, but instead, flows have a strict order of priority and this which determines popping
order. That is, the second-highest priority subqueue will only be allowed to pop if the highest priority subqueue is empty.
If the higher-priority flow get pushed to in the interim, the next call to <code>pop</code> will again try to pop from the highest priority flow.</p>
<p>Like round-robin queues, it takes in a list <code>boundaries</code> that must be of length <code>n</code>, which divide the incoming traffic into <code>n</code> flows.
For example, if <code>n = 3</code> and the client passes boundaries <code>[133, 266, 400]</code>,
packets will be divided into three flows according to the intervals: <code>[0, 133]</code>, <code>[134, 266]</code>, <code>[267, 400]</code>.</p>
<p>It takes a list <code>order</code> that must be of length <code>n</code>, which specifies the order
of priority of the flows. For example, if <code>n = 3</code> and the client passes order
<code>[1, 2, 0]</code>, then flow 1 (packets in range <code>[134, 266]</code>) has first priority, flow 2
(packets in range <code>[267, 400]</code>) has second priority, and flow 0 (packets in range
<code>[0, 133]</code>) has last priority.</p>
<ul>
<li>At push, we check the <code>boundaries</code> list to determine which flow to push to.
Take the boundaries example given earlier, <code>[133, 266, 400]</code>.
If we push the value <code>89</code>, it will, under the hood, be pushed into subqueue 0 because <code>0 &lt;= 89 &lt;= 133</code>,
and <code>305</code> will be pushed into subqueue 2 since <code>266 &lt;= 305 &lt;= 400</code>.</li>
<li>Pop first tries to pop from <code>order[0]</code>. If this succeeds, great. If it fails, it tries <code>order[1]</code>, and so on.</li>
</ul>
<p>The source code is available in [<code>gen_strict_or_rr.py</code>][gen_strict_or_rr.py], which takes as arguments <code>n</code>, <code>boundaries</code>, <code>order</code>, and handles to the subqueues it must administer. It also takes a boolean parameter <code>round_robin</code>, which, if <code>false</code>, results in the generation of a strict queue.</p>
<h2 id="pifo-tree"><a class="header" href="#pifo-tree">PIFO Tree</a></h2>
<p>A PIFO tree is a tree-shaped data structure in which each node is associated with a PIFO.
The PIFO tree stores elements in its leaf PIFOs and scheduling metadata in its internal nodes.</p>
<p>Pushing a new element into a PIFO tree involves putting the element into a leaf PIFO and putting additional metadata into internal nodes from the root to the leaf.
A variety of scheduling policies can be realized by manipulating the various priorities with which this data is inserted into each PIFO.
Popping the most favorably ranked element from a PIFO tree is relatively straightforward: popping the root PIFO tells us which child PIFO to pop from next, and we recurse until we reach a leaf PIFO.
We refer interested readers to <a href="https://dl.acm.org/doi/10.1145/2934872.2934899">this</a> research paper for more details on PIFO trees.</p>
<p>Our frontend allows for the creation of PIFO trees of any height, number of children, and with
the scheduling policy at each internal node being <em>round-robin</em> or <em>strict</em>.</p>
<p>See the <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/tests/pifo_tree_test.py">source code</a> for an example where we create a PIFO tree of height 2.
Specifically, the example implements the PIFO tree described in §2 of <a href="https://dl.acm.org/doi/10.1145/3622845">this</a> research paper.</p>
<p>Internally, our PIFO tree is implemented by leveraging the PIFO frontend.
The PIFO frontend seeks to orchestrate two queues, which in the simple case will just be two FIFOs.
However, it is easy to generalize those two queues: instead of being FIFOs, they can be PIFOs or even PIFO trees.</p>
<p>We see a more complex example of a PIFO tree in [<code>complex_tree_test.py</code>] <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/tests/complex_tree_test.py">complex_tree_test.py</a>. This tree does round robin between three children, two of which are strict queues and the other is a round robin queue. This tree has a height of 3. The overall structure is <code>rr(strict(A, B, C), rr(D, E, F), strict(G, H))</code>.</p>
<h2 id="minimum-binary-heap"><a class="header" href="#minimum-binary-heap">Minimum Binary Heap</a></h2>
<p>A minimum binary heap is another tree-shaped data structure where each node has at most two children.
However, unlike the queues discussed above, a heap exposes an extended interface:
in addition to the input ports and reference registers discussed above, a heap has an additional input <code>rank</code>.
The <code>push</code> operation now accepts both a <code>value</code> and the <code>rank</code> that the user wishes to associate with that value.
Consequently, a heap <em>orders</em> its elements by <code>rank</code>, with the <code>pop</code> operation set to remove the element with minimal rank.</p>
<p>To maintain this ordering efficiently, a heap stores <code>(rank, value)</code> pairs in each node and takes special care to maintain the following invariant:</p>
<blockquote>
<p><strong>Min-Heap Property</strong>: for any given node <code>C</code>, if <code>P</code> is a parent of <code>C</code>, then the rank of <code>P</code> is less than or equal to the rank of <code>C</code>.</p>
</blockquote>
<p>To <code>push</code> or <code>pop</code> an element is easy at the top level: write to or read from the correct node, and then massage the tree to restore the Min-Heap Property.
The <code>push</code> and <code>pop</code> operations are logarithmic in the size of the heap.</p>
<p>Our frontend allows for the creation of minimum binary heaps in Calyx; the source code is available in <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/queues/binheap/binheap.py"><code>binheap.py</code></a>.</p>
<p>One quirk of any minimum binary heap is its ambiguous behavior in the case of rank ties.
More specifically, if the value <code>a</code> is pushed with some rank, and then later value <code>b</code> is pushed with the same rank, it’s unclear which will be popped first.
Often, it’s desirable to break such ties in FIFO order: that is we’d like a guarantee that <code>a</code> will be popped first.
A binary heap that provides this guarantee is called a <em>stable binary heap</em>, and our frontend provides a thin layer over our heap that enforces this property.</p>
<p>Our <code>stable_binheap</code> is a heap accepting 32-bit ranks and values.
It uses a counter <code>i</code> and instantiates, in turn, a binary heap that accepts 64-bit ranks and 32-bit values.</p>
<ul>
<li>To push a pair <code>(r, v)</code> into <code>stable_binheap</code>, we craft a new 64-bit rank that incorporates the counter <code>i</code> (specifically, we compute <code>r &lt;&lt; 32 + i</code>), and we push <code>v</code> into our underlying binary heap with this new 64-bit rank. We also increment the counter <code>i</code>.</li>
<li>To pop <code>stable_binheap</code>, we pop the underlying binary heap.</li>
</ul>
<p>The source code is available in <a href="https://github.com/calyxir/calyx/blob/main/frontends/queues/queues/binheap/stable_binheap.py"><code>stable_binheap.py</code></a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../frontends/ntt.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../frontends/mrxl.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../frontends/ntt.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../frontends/mrxl.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>

<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Static Timing - Calyx Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">Getting Started</a></li><li class="chapter-item expanded affix "><li class="part-title">Calyx Language</li><li class="chapter-item expanded "><a href="../tutorial/language-tut.html"><strong aria-hidden="true">1.</strong> Language Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/multi-component.html"><strong aria-hidden="true">1.1.</strong> Multi-Component Designs</a></li><li class="chapter-item expanded "><a href="../lang/memories-by-reference.html"><strong aria-hidden="true">1.2.</strong> Passing Memories by Reference</a></li></ol></li><li class="chapter-item expanded "><a href="../lang/ref.html"><strong aria-hidden="true">2.</strong> Language Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/data-format.html"><strong aria-hidden="true">2.1.</strong> Data Format</a></li><li class="chapter-item expanded "><a href="../lang/static.html" class="active"><strong aria-hidden="true">2.2.</strong> Static Timing</a></li><li class="chapter-item expanded "><a href="../lang/sync.html"><strong aria-hidden="true">2.3.</strong> Experimental: Synchronization</a></li><li class="chapter-item expanded "><a href="../lang/undefined.html"><strong aria-hidden="true">2.4.</strong> Undefined Behaviors</a></li></ol></li><li class="chapter-item expanded "><a href="../lang/attributes.html"><strong aria-hidden="true">3.</strong> Attributes</a></li><li class="chapter-item expanded affix "><li class="part-title">Running Calyx Programs</li><li class="chapter-item expanded "><a href="../running-calyx/fud/index.html"><strong aria-hidden="true">4.</strong> fud: The Calyx Driver</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../running-calyx/fud/examples.html"><strong aria-hidden="true">4.1.</strong> Examples</a></li><li class="chapter-item expanded "><a href="../running-calyx/fud/xilinx.html"><strong aria-hidden="true">4.2.</strong> Xilinx Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../running-calyx/fud/axi-gen.html"><strong aria-hidden="true">4.2.1.</strong> AXI Generation</a></li></ol></li><li class="chapter-item expanded "><a href="../running-calyx/fud/external.html"><strong aria-hidden="true">4.3.</strong> External Stages</a></li><li class="chapter-item expanded "><a href="../running-calyx/fud/multiple-paths.html"><strong aria-hidden="true">4.4.</strong> Multiple Paths</a></li><li class="chapter-item expanded "><a href="../running-calyx/fud/circt.html"><strong aria-hidden="true">4.5.</strong> CIRCT</a></li><li class="chapter-item expanded "><a href="../running-calyx/fud/resource-estimation.html"><strong aria-hidden="true">4.6.</strong> Resource Estimation</a></li></ol></li><li class="chapter-item expanded "><a href="../running-calyx/fud2.html"><strong aria-hidden="true">5.</strong> fud2: Experimental Driver</a></li><li class="chapter-item expanded "><a href="../running-calyx/interfacing.html"><strong aria-hidden="true">6.</strong> Interfacing with Calyx RTL</a></li><li class="chapter-item expanded "><a href="../running-calyx/interpreter.html"><strong aria-hidden="true">7.</strong> The Calyx Interpreter</a></li><li class="chapter-item expanded affix "><li class="part-title">Compiler Development Guide</li><li class="chapter-item expanded "><a href="../compiler.html"><strong aria-hidden="true">8.</strong> The Calyx Compiler</a></li><li class="chapter-item expanded "><a href="../new-pass.html"><strong aria-hidden="true">9.</strong> Adding a New Pass</a></li><li class="chapter-item expanded "><a href="../libraries/core.html"><strong aria-hidden="true">10.</strong> Primitive Library</a></li><li class="chapter-item expanded "><a href="../compiler-as-library.html"><strong aria-hidden="true">11.</strong> The calyx Library</a></li><li class="chapter-item expanded "><a href="../optimizations/dataflow.html"><strong aria-hidden="true">12.</strong> Dataflow Analysis</a></li><li class="chapter-item expanded "><a href="../debug/index.html"><strong aria-hidden="true">13.</strong> Debugging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../debug/cider.html"><strong aria-hidden="true">13.1.</strong> Logical Bugs</a></li><li class="chapter-item expanded "><a href="../debug/debug.html"><strong aria-hidden="true">13.2.</strong> Compilation Bugs</a></li></ol></li><li class="chapter-item expanded "><a href="../github.html"><strong aria-hidden="true">14.</strong> Contributing to Calyx</a></li><li class="chapter-item expanded affix "><li class="part-title">Generating Calyx</li><li class="chapter-item expanded "><a href="../builder/calyx-py.html"><strong aria-hidden="true">15.</strong> Emitting Calyx from Python</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../builder/ref.html"><strong aria-hidden="true">15.1.</strong> calyx-py Builder Reference</a></li></ol></li><li class="chapter-item expanded "><a href="../tutorial/frontend-tut.html"><strong aria-hidden="true">16.</strong> Frontend Tutorial</a></li><li class="chapter-item expanded "><a href="../frontends/index.html"><strong aria-hidden="true">17.</strong> Frontend Compilers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../frontends/dahlia.html"><strong aria-hidden="true">17.1.</strong> Dahlia</a></li><li class="chapter-item expanded "><a href="../frontends/systolic-array.html"><strong aria-hidden="true">17.2.</strong> Systolic Array Generator</a></li><li class="chapter-item expanded "><a href="../frontends/tvm-relay.html"><strong aria-hidden="true">17.3.</strong> TVM Relay</a></li><li class="chapter-item expanded "><a href="../frontends/ntt.html"><strong aria-hidden="true">17.4.</strong> NTT Pipeline Generator</a></li><li class="chapter-item expanded "><a href="../frontends/mrxl.html"><strong aria-hidden="true">17.5.</strong> MrXL</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Tools</li><li class="chapter-item expanded "><a href="../tools/runt.html"><strong aria-hidden="true">18.</strong> Runt</a></li><li class="chapter-item expanded "><a href="../tools/data-gen.html"><strong aria-hidden="true">19.</strong> Data Gen</a></li><li class="chapter-item expanded "><a href="../tools/exp-generator.html"><strong aria-hidden="true">20.</strong> exp Generator</a></li><li class="chapter-item expanded "><a href="../tools/editor-highlighting.html"><strong aria-hidden="true">21.</strong> Editor Highlighting</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Calyx Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="static-timing"><a class="header" href="#static-timing">Static Timing</a></h1>
<p>By default, Calyx programs use a <em>latency-insensitive</em>, or <em>dynamic</em>, model of computation.
This means that the compiler does not know, track, or guarantee the number of cycles it takes to perform a computation or run a control operator.
This is in contrast to a <em>latency-sensitive</em>, or <em>static</em>, model of computation, where the number of cycles a component needs is known to, and honored by, the compiler.</p>
<p>In general, latency-insensitivity makes it easier to compose programs.
It grants the compiler freedom to schedule operators however it wants, as long as the schedule meets the program's dataflow constraints.
It also prevents code from implicitly depending on the state of other code running in parallel.</p>
<p>However, there are two drawbacks to this approach.
First, the generated hardware may not be efficient: if the compiler does not know how long computations take, it must schedule them conservatively.
Second, it is impossible for <em>latency-insensitive</em> programs to interact with <em>latency-sensitive</em> hardware implemented in RTL;
this means that the use of black-box hardware designs requires costly handshaking logic at the interface.</p>
<p>To address these issues, Calyx provides a <code>static</code> qualifier that modifies components and groups, along with static variants of other control operators.</p>
<p>Broadly, the <code>static</code> qualifier is a promise to the compiler that the component or group will take exactly the specified number of cycles to execute.
The compiler is free to take advantage of this promise to generate more efficient hardware.
In return, the compiler must access out-ports of static components only after the specified number of cycles have passed, or risk receiving incorrect results.</p>
<h2 id="static-constructs-in-the-calyx-il"><a class="header" href="#static-constructs-in-the-calyx-il">Static Constructs in the Calyx IL</a></h2>
<p>We will now discuss the static constructs available in the Calyx IL, along with the guarantees they come with.</p>
<h3 id="static-components"><a class="header" href="#static-components">Static Components</a></h3>
<p>Briefly consider a divider component, <code>std_div</code>, which divides the value <code>left</code> by the value <code>right</code> and puts the result in <code>out</code>.
This component is dynamic; its latency is unknown.</p>
<pre><code>primitive std_div[W](go: 1, left: W, right: W) -&gt; (out: W, done: 1);
</code></pre>
<p>A client of the divider must pass two inputs, raise the <code>go</code> signal, and wait for the component itself to raise its <code>done</code> signal.
The client can then read the result from the <code>out</code> port.
That is, it obeys the <a href="./ref.html#the-go-done-interface">go-done interface</a>.</p>
<p>Compare this to a multiplier component, <code>std_mult</code>, which has a similar signature but whose latency is known to be three cycles.
We declare it as follows:</p>
<pre><code>static&lt;3&gt; primitive std_mult[W](go: 1, left: W, right: W) -&gt; (out: W);
</code></pre>
<p>The key differences are:</p>
<ul>
<li>The <code>static</code> qualifier is used to declare the component as static and to specify its latency.</li>
<li>The <code>done</code> port is not present in the static component.</li>
</ul>
<p>A client of the multiplier must pass two inputs and raise the <code>go</code> signal as before.
However, the client need not then wait for the component to indicate completion.
It can simply and safely assume that the result will be available after 3 cycles.
This is a guarantee that the author of the component has made to the client, and the compiler is free to take advantage of it.</p>
<h3 id="static-groups-and-relative-timing-guards"><a class="header" href="#static-groups-and-relative-timing-guards">Static Groups and Relative Timing Guards</a></h3>
<p>Much like components, groups can be declared as static.
Since groups are just unordered sets of assignments, it pays to have a little more control over the scheduling of the assignments within a group.
To this end, static groups have a unique feature that ordinary dynamic groups do not: <em>relative timing guards</em>.</p>
<p>Consider this group, which multiplies <code>6</code> and <code>7</code> and stores the result in <code>ans</code>.</p>
<pre><code>static&lt;4&gt; group mult_and_store {
  mult.left = %[0:3] ? 6;
  mult.right = %[0:3] ? 7;
  mult.go = %[0:3] ? 1;
  ans.in = %3 ? mult.out;
  ans.write_en = %3 ? 1;
}
</code></pre>
<p>The <code>static&lt;4&gt;</code> qualifier specifies that the group should take 4 cycles to execute.</p>
<p>The first three assignments are guarded (using the <a href="./ref.html#guarded-assignments">standard <code>?</code> separator</a>) by the relative timing guard <code>%[0:3]</code>.
In general, a relative timing guard <code>%[i:j]</code> is <em>true</em> in the half-open interval from cycle <code>i</code> to
cycle <code>j</code> of the group’s execution and <em>false</em> otherwise.</p>
<p>In our case, the first three assignments execute only in the first three cycles of the group's execution.
The guard <code>%3</code>, which we see immediately afterwards, is syntactic sugar for <code>%[3:4]</code>.
We have used it in this case to ensure that the last two assignments execute only in the last cycle of the group's execution.</p>
<h3 id="static-control-operators"><a class="header" href="#static-control-operators">Static Control Operators</a></h3>
<p>Calyx provides static variants of each of its <a href="./ref.html#the-control-operators">control operators</a>.
While dynamic commands may contain both static and dynamic children, static commands must only have static children.
In the examples below, assume that <code>A5</code>, <code>B6</code>, <code>C7</code>, and <code>D8</code> are static groups with latencies 5, 6, 7, and 8, respectively.</p>
<h4 id="static-seq-a-static-version-of-seq"><a class="header" href="#static-seq-a-static-version-of-seq"><code>static seq</code>, a static version of <a href="./ref.html#seq"><code>seq</code></a></a></h4>
<p>If we have <code>static seq { A5; B6; C7; D8; }</code>, we can guarantee that the latency of the entire operation is the sum of the latencies of its children: 5 + 6 + 7 + 8 = 26 cycles in this case.
We can also guarantee that, each child will begin executing exactly one cycle after the previous child has finished.
In our case, for example, <code>B6</code> will begin executing exactly one cycle after <code>A5</code> has finished.</p>
<h4 id="static-par-a-static-version-of-par"><a class="header" href="#static-par-a-static-version-of-par"><code>static par</code>, a static version of <a href="./ref.html#par"><code>par</code></a></a></h4>
<p>If we have <code>static par { A5; B6; C7; D8; }</code>, we can guarantee that the latency of the entire operation is the maximum of the latencies of its children: 8 cycles in this case.
Further, all the children of a <code>static par</code> are guaranteed to begin executing at the same time.
The children can rely on this &quot;lockstep&quot; behavior and can communicate with each other.
Such communication is undefined behavior in a standard, dynamic, <code>par</code>.</p>
<h4 id="static-if-a-static-version-of-if"><a class="header" href="#static-if-a-static-version-of-if"><code>static if</code>, a static version of <a href="./ref.html#if"><code>if</code></a></a></h4>
<p>If we have <code>static if { A5; B6; }</code>, we can guarantee that the latency of the entire operation is the maximum of the latencies of its children: 6 cycles in this case.</p>
<h4 id="static-repeat-a-static-version-of-repeat"><a class="header" href="#static-repeat-a-static-version-of-repeat"><code>static repeat</code>, a static version of <a href="./ref.html#repeat"><code>repeat</code></a></a></h4>
<blockquote>
<p>Calyx's <code>while</code> loop is unbouded and so it does not have a static variant.</p>
</blockquote>
<p>If we have <code>static repeat 7 { B6; }</code>, we can guarantee that the latency of the entire operation is the product of the number of iterations and the latency of its child: 7 × 6 = 42 cycles in this case.
The body of a <code>static repeat</code> is guaranteed to begin executing exactly one cycle after the previous iteration has finished.</p>
<h4 id="static-invoke-a-static-version-of-invoke"><a class="header" href="#static-invoke-a-static-version-of-invoke"><code>static invoke</code>, a static version of <a href="./ref.html#invoke"><code>invoke</code></a></a></h4>
<p>Its latency is the latency of the invoked cell.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../lang/data-format.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../lang/sync.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../lang/data-format.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../lang/sync.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>

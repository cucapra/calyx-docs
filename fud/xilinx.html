<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Xilinx Tools - Calyx Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">Getting Started</a></li><li class="chapter-item expanded affix "><li class="part-title">Calyx Language</li><li class="chapter-item expanded "><a href="../tutorial/language-tut.html"><strong aria-hidden="true">1.</strong> Language Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/multi-component.html"><strong aria-hidden="true">1.1.</strong> Multi-Component Designs</a></li><li class="chapter-item expanded "><a href="../lang/memories-by-reference.html"><strong aria-hidden="true">1.2.</strong> Passing Memories by Reference</a></li></ol></li><li class="chapter-item expanded "><a href="../lang/ref.html"><strong aria-hidden="true">2.</strong> Language Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lang/data-format.html"><strong aria-hidden="true">2.1.</strong> Data Format</a></li><li class="chapter-item expanded "><a href="../lang/static.html"><strong aria-hidden="true">2.2.</strong> Static Timing</a></li><li class="chapter-item expanded "><a href="../lang/sync.html"><strong aria-hidden="true">2.3.</strong> Experimental: Synchronization</a></li><li class="chapter-item expanded "><a href="../lang/undefined.html"><strong aria-hidden="true">2.4.</strong> Undefined Behaviors</a></li></ol></li><li class="chapter-item expanded "><a href="../lang/attributes.html"><strong aria-hidden="true">3.</strong> Attributes</a></li><li class="chapter-item expanded affix "><li class="part-title">Running Calyx Programs</li><li class="chapter-item expanded "><a href="../fud/index.html"><strong aria-hidden="true">4.</strong> fud: The Calyx Driver</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fud/examples.html"><strong aria-hidden="true">4.1.</strong> Examples</a></li><li class="chapter-item expanded "><a href="../fud/xilinx.html" class="active"><strong aria-hidden="true">4.2.</strong> Xilinx Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fud/axi-gen.html"><strong aria-hidden="true">4.2.1.</strong> AXI Generation</a></li></ol></li><li class="chapter-item expanded "><a href="../fud/external.html"><strong aria-hidden="true">4.3.</strong> External Stages</a></li><li class="chapter-item expanded "><a href="../fud/multiple-paths.html"><strong aria-hidden="true">4.4.</strong> Multiple Paths</a></li><li class="chapter-item expanded "><a href="../fud/circt.html"><strong aria-hidden="true">4.5.</strong> CIRCT</a></li><li class="chapter-item expanded "><a href="../fud/resource-estimation.html"><strong aria-hidden="true">4.6.</strong> Resource Estimation</a></li></ol></li><li class="chapter-item expanded "><a href="../interpreter.html"><strong aria-hidden="true">5.</strong> The Calyx Interpreter</a></li><li class="chapter-item expanded affix "><li class="part-title">Compile Development Guide</li><li class="chapter-item expanded "><a href="../compiler.html"><strong aria-hidden="true">6.</strong> The Calyx Compiler</a></li><li class="chapter-item expanded "><a href="../new-pass.html"><strong aria-hidden="true">7.</strong> Adding a New Pass</a></li><li class="chapter-item expanded "><a href="../libraries/core.html"><strong aria-hidden="true">8.</strong> Primitive Library</a></li><li class="chapter-item expanded "><a href="../compiler-as-library.html"><strong aria-hidden="true">9.</strong> The calyx Library</a></li><li class="chapter-item expanded "><a href="../optimizations/dataflow.html"><strong aria-hidden="true">10.</strong> Dataflow Analysis</a></li><li class="chapter-item expanded "><a href="../debug/index.html"><strong aria-hidden="true">11.</strong> Debugging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../debug/cider.html"><strong aria-hidden="true">11.1.</strong> Logical Bugs</a></li><li class="chapter-item expanded "><a href="../debug/debug.html"><strong aria-hidden="true">11.2.</strong> Compilation Bugs</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Generating Calyx</li><li class="chapter-item expanded "><a href="../calyx-py.html"><strong aria-hidden="true">12.</strong> Emitting Calyx from Python</a></li><li class="chapter-item expanded "><a href="../tutorial/frontend-tut.html"><strong aria-hidden="true">13.</strong> Frontend Tutorial</a></li><li class="chapter-item expanded "><a href="../frontends/index.html"><strong aria-hidden="true">14.</strong> Frontend Compilers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../frontends/dahlia.html"><strong aria-hidden="true">14.1.</strong> Dahlia</a></li><li class="chapter-item expanded "><a href="../frontends/systolic-array.html"><strong aria-hidden="true">14.2.</strong> Systolic Array Generator</a></li><li class="chapter-item expanded "><a href="../frontends/tvm-relay.html"><strong aria-hidden="true">14.3.</strong> TVM Relay</a></li><li class="chapter-item expanded "><a href="../frontends/ntt.html"><strong aria-hidden="true">14.4.</strong> NTT Pipeline Generator</a></li><li class="chapter-item expanded "><a href="../frontends/mrxl.html"><strong aria-hidden="true">14.5.</strong> MrXL</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Tools</li><li class="chapter-item expanded "><a href="../tools/runt.html"><strong aria-hidden="true">15.</strong> Runt</a></li><li class="chapter-item expanded "><a href="../tools/data-gen.html"><strong aria-hidden="true">16.</strong> Data Gen</a></li><li class="chapter-item expanded "><a href="../tools/exp-generator.html"><strong aria-hidden="true">17.</strong> exp Generator</a></li><li class="chapter-item expanded "><a href="../tools/editor-highlighting.html"><strong aria-hidden="true">18.</strong> Editor Highlighting</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Calyx Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="xilinx-toolchain"><a class="header" href="#xilinx-toolchain">Xilinx Toolchain</a></h1>
<blockquote>
<p>Working with vendor EDA toolchains is never a fun experience. Something will
almost certainly go wrong. If you're at Cornell, you can at least avoid
installing the tools yourself by using our lab servers, <a href="https://capra.cs.cornell.edu/private/gorgonzola.html">Gorgonzola</a> or <a href="https://capra.cs.cornell.edu/private/havarti.html">Havarti</a>.</p>
</blockquote>
<p><code>fud</code> can interact with the Xilinx tools (<a href="https://www.xilinx.com/products/design-tools/vivado.html">Vivado</a>, <a href="https://www.xilinx.com/products/design-tools/vivado/integration/esl-design.html">Vivado HLS</a>, and <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-platform.html">Vitis</a>). There are three main things it can do:</p>
<ul>
<li>Synthesize Calyx-generated RTL designs to collect area and resource estimates.</li>
<li>Compile <a href="https://capra.cs.cornell.edu/dahlia/">Dahlia</a> programs via C++ and <a href="https://www.xilinx.com/products/design-tools/vivado/integration/esl-design.html">Vivado HLS</a> for comparison with the Calyx backend.</li>
<li>Compile Calyx programs for <em>actual execution</em> in Xilinx emulation modes or on real FPGA hardware.</li>
</ul>
<p>You can set <code>fud</code> up to use either a local installation of the Xilinx tools or one on a remote server, via SSH.</p>
<h2 id="synthesis-only"><a class="header" href="#synthesis-only">Synthesis Only</a></h2>
<p>The simplest way to use the Xilinx tools is to synthesize RTL or HLS designs to collect statistics about them.
This route will not produce actual, runnable executables; see the next section for that.</p>
<h3 id="installing-dependencies"><a class="header" href="#installing-dependencies">Installing Dependencies</a></h3>
<p><code>fud</code> uses extra dependencies to invoke the Xilinx toolchains.
Run the following command to install all required dependencies:</p>
<pre><code>cd fud &amp;&amp; flit install -s --deps all
</code></pre>
<h3 id="setting-up-remote-tools"><a class="header" href="#setting-up-remote-tools">Setting up Remote Tools</a></h3>
<blockquote>
<p>Follow these instructions if you're attempting to run <code>vivado</code> or <code>vivado-hls</code> on a server from your local machine. If you are working directly on a server with these tools, skip to the <a href="#run">run instructions</a>.</p>
</blockquote>
<p>To set up to <strong>invoke the Xilinx tools over SSH</strong>, first tell <code>fud</code> your username and hostname for the server:</p>
<pre><code># Vivado
fud config stages.synth-verilog.ssh_host &lt;hostname&gt;
fud config stages.synth-verilog.ssh_username &lt;username&gt;

# Vivado HLS
fud config stages.vivado-hls.ssh_host &lt;hostname&gt;
fud config stages.vivado-hls.ssh_username &lt;username&gt;
</code></pre>
<p>The following commands enable remote usage of <code>vivado</code> and <code>vivado-hls</code> by default:</p>
<pre><code>fud config stages.synth-verilog.remote 1
fud config stages.vivado-hls.remote 1
</code></pre>
<p>The server must have <code>vivado</code> and <code>vivado_hls</code> available on the remote machine's path. (If you need the executable names to be something else, please file an issue.)</p>
<p>To tell if this has been set up correctly, run <code>ssh &lt;username&gt;@&lt;xilinx.tool.server&gt;</code> and ensure that you are not prompted for a password. The <code>ssh-copy-id</code> command will let you setup your server to authenticate without a password. Note that after you SSH into the server, the Vivado command should work without needing to run any source command. </p>
<p>Here's how you would ssh into Havarti:</p>
<pre><code>ssh user@havarti.cs.cornell.edu
user@havarti:~$ vivado

****** Vivado v2020.2 (64-bit)
</code></pre>
<h3 id="setting-up-local-tools"><a class="header" href="#setting-up-local-tools">Setting up Local Tools</a></h3>
<p>To instead <strong>invoke the Xilinx tools locally</strong>, just let <code>fud</code> run the <code>vivado</code> and <code>vivado_hls</code> commands.
You can optionally tell <code>fud</code> where these commands exist on your machine:</p>
<pre><code>fud config stages.synth-verilog.exec &lt;path&gt; # update vivado path
fud config stages.vivado-hls.exec &lt;path&gt; # update vivado_hls path
</code></pre>
<p>Setting the <code>remote</code> option for the stages to <code>0</code> ensure that <code>fud</code> will always try to run the commands locally.</p>
<pre><code>fud config stages.synth-verilog.remote 0
fud config stages.vivado-hls.remote 0
</code></pre>
<h3 id="run"><a class="header" href="#run">Run</a></h3>
<p>To run the entire toolchain and extract statistics from RTL synthesis, use the <code>resource-estimate</code> target state.
For example:</p>
<pre><code>fud e --to resource-estimate examples/futil/dot-product.futil
</code></pre>
<p>To instead obtain the raw synthesis results, use <code>synth-files</code>.</p>
<p>To run the analogous toolchain for Dahlia programs via HLS, use the <code>hls-estimate</code> target state:</p>
<pre><code>fud e --to hls-estimate examples/dahlia/dot-product.fuse
</code></pre>
<p>There is also an <code>hls-files</code> state for the raw results of Vivado HLS.</p>
<h2 id="emulation-and-execution"><a class="header" href="#emulation-and-execution">Emulation and Execution</a></h2>
<p><code>fud</code> can also compile Calyx programs for actual execution, either in the Xilinx toolchain's emulation modes or for running on a physical FPGA.
This route involves generating an <a href="https://en.wikipedia.org/wiki/Advanced_eXtensible_Interface">AXI</a> interface wrapper for the Calyx program and invoking it using Xilinx's <a href="https://github.com/Xilinx/PYNQ">PYNQ</a> interface.</p>
<h3 id="set-up"><a class="header" href="#set-up">Set Up</a></h3>
<p>As above, you can invoke the Xilinx toolchain locally or remotely, via SSH.
To set up SSH execution, you can edit your <code>config.toml</code> to add settings like this:</p>
<pre><code>[stages.xclbin]
ssh_host = &quot;havarti&quot;
ssh_username = &quot;als485&quot;
remote = 1
</code></pre>
<p>To use local execution, just leave off the <code>remote = true</code> line.</p>
<p>You can also set the Xilinx mode and target device:</p>
<pre><code>[stages.xclbin]
mode = &quot;hw_emu&quot;
device = &quot;xilinx_u50_gen3x16_xdma_201920_3&quot;
</code></pre>
<p>The options for <code>mode</code> are <code>hw_emu</code> (simulation) and <code>hw</code> (on-FPGA execution).
The device string above is for the <a href="https://www.xilinx.com/products/boards-and-kits/alveo/u50.html">Alveo U50</a> card, which we have at Cornell. The installed Xilinx card would typically be found under the directory <code>/opt/xilinx/platforms</code>, where one would be able to find a device name of interest.</p>
<h3 id="compile"><a class="header" href="#compile">Compile</a></h3>
<p>The first step in the Xilinx toolchain is to generate <a href="https://xilinx.github.io/XRT/2021.2/html/formats.html#xclbin">an <code>xclbin</code> executable file</a>.
Here's an example of going all the way from a Calyx program to that:</p>
<pre><code>fud e examples/futil/dot-product.futil -o foo.xclbin --to xclbin
</code></pre>
<p>On our machines, compiling even a simple example like the above for simulation takes about 5 minutes, end to end.
A failed run takes about 2 minutes to produce an error.</p>
<p>By default, the Xilinx tools run in a temporary directory that is deleted when <code>fud</code> finishes.
To instead keep the sandbox directory, use <code>-s xclbin.save_temps true</code>.
You can then find the results in a directory named <code>fud-out-N</code> for some number <code>N</code>.</p>
<h3 id="execute"><a class="header" href="#execute">Execute</a></h3>
<p>Now that you have an <code>xclbin</code>, the next step is to run it.
Roughly speaking, the command you need is just a <code>fud</code> invocation that goes from the <code>xclbin</code> stage to the <code>fpga</code> stage:</p>
<pre><code>fud e foo.xclbin --from xclbin --to fpga -s fpga.data examples/dahlia/dot-product.fuse.data
</code></pre>
<p>Contrary to the name, the <code>fpga</code> stage works for both emulation and on-FPGA execution---fud's <code>mode</code> config option for this stage chooses which to use.
The <code>fpga.data</code> config option provides a normal fud-style JSON data input file for the run.</p>
<p>Currently, you will need to have a bunch of environment variables set up to point to the Xilinx tools <em>before running this fud command</em>.
For example, on our group's havarti server, you can do this:</p>
<pre><code>source /scratch/opt/Xilinx/Vitis/2020.2/settings64.sh
source /opt/xilinx/xrt/setup.sh
export EMCONFIG_PATH=`pwd`
</code></pre>
<p>To prepare for hardware emulation of an xclbin compiled appropriately, run:</p>
<pre><code>export XCL_EMULATION_MODE=hw_emu
</code></pre>
<p>If preparing for actual hardware execution, ensure the <code>XCL_EMULATION_MODE</code> environment variable is unset:</p>
<pre><code>unset XCL_EMULATION_MODE
</code></pre>
<p>These steps source the setup scripts for both <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-platform.html">Vitis</a> and <a href="https://xilinx.github.io/XRT/">XRT</a>,
and set a special <code>EMCONFIG_PATH</code> to your current directory so that fud can generate a <a href="https://docs.xilinx.com/r/en-US/ug1393-vitis-application-acceleration/emconfigutil-Utility">special JSON configuration file for Xilinx emulation</a>.
You also need to tell PYNQ whether you want <code>hw_emu</code> (emulation) or the default on-device execution to occur by exporting or unsetting the <code>XCL_EMULATION_MODE</code> environment variable.
Of course, it would be better if all this could come from fud's configuration itself instead of requiring you to set it up ahead of time;
<a href="https://github.com/cucapra/calyx/issues/872">issue #872</a> covers this work.</p>
<h4 id="waveform-debugging"><a class="header" href="#waveform-debugging">Waveform Debugging</a></h4>
<p>In emulation mode, this stage can produce a waveform trace in Xilinx's proprietary <a href="https://support.xilinx.com/s/article/64000?language=en_US">WDB</a> file format as well as a standard <a href="https://en.wikipedia.org/wiki/Value_change_dump">VCD</a> file.</p>
<p>Use the fud options <code>-s fpga.waveform true -s fpga.save_temps true</code> when emulating your program.
The first option instructs XRT to use <a href="https://xilinx.github.io/Vitis_Accel_Examples/2021.1/html/debug_profile.html">the <code>batch</code> debug mode</a> and to dump a VCD, and the second asks fud not to delete the directory where the waveform files will appear.</p>
<p>Then, look in the resulting directory, which will be named <code>fud-out-*</code> for some <code>*</code>.
In there, the Xilinx trace files you want are named <code>*.wdb</code> and <code>*.wcfg</code>.
The VCD file is at <code>.run/*/hw_em/device0/binary_0/behav_waveform/xsim/dump.vcd</code> or similar.</p>
<h3 id="how-it-works"><a class="header" href="#how-it-works">How it Works</a></h3>
<p>The first step is to generate input files.
We need to generate:</p>
<ul>
<li>The RTL for the design itself, using the compile command-line flags <code>-b verilog --synthesis -p external</code>. We name this file <code>main.sv</code>.</li>
<li>A Verilog interface wrapper, using <code>XilinxInterfaceBackend</code>, via <code>-b xilinx</code>. We call this <code>toplevel.v</code>.</li>
<li>An XML document describing the interface, using <code>XilinxXmlBackend</code>, via <code>-b xilinx-xml</code>. This file gets named <code>kernel.xml</code>.</li>
</ul>
<p>The <code>fud</code> driver gathers these files together in a sandbox directory.
The next step is to run the Xilinx tools.</p>
<p>The rest of this section describes how this workflow works under the hood.
If you want to follow along by typing commands manually, you can start by invoking the setup scripts for <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-platform.html">Vitis</a> and <a href="https://xilinx.github.io/XRT/">XRT</a>:</p>
<pre><code>source &lt;Vitis_install_path&gt;/Vitis/2020.1/settings64.sh
source /opt/xilinx/xrt/setup.sh
</code></pre>
<p>On some Ubuntu setups, you may need to update <code>LIBRARY_PATH</code>:</p>
<pre><code>export LIBRARY_PATH=/usr/lib/x86_64-linux-gnu
</code></pre>
<p>You can check that everything is working by typing <code>vitis -version</code> or <code>vivado -version</code>.</p>
<h4 id="background-xo-and-xclbin"><a class="header" href="#background-xo-and-xclbin">Background: <code>.xo</code> and <code>.xclbin</code></a></h4>
<p>In the Xilinx toolchain, compilation to an executable bitstream (or simulation blob) appears to requires two steps:
taking your Verilog sources and creating an <code>.xo</code> file, and then taking that and producing an <code>.xclbin</code> “executable” file.
The idea appears to be a kind of metaphor for a standard C compilation workflow in software-land: <code>.xo</code> is like a <code>.o</code> object file, and <code>.xclbin</code> contains actual executable code (bitstream or emulation equivalent), like a software executable binary.
Going from Verilog to <code>.xo</code> is like “compilation” and going from <code>.xo</code> to <code>.xclbin</code> is like “linking.”</p>
<p>However,  this analogy is kind of a lie.
Generating an <code>.xo</code> file actually does very little work:
it just packages up the Verilog source code and some auxiliary files.
An <code>.xo</code> is literally a zip file with that stuff packed up inside.
All the actual work happens during “linking,” i.e., going from <code>.xo</code> to <code>.xclbin</code> using the <code>v++</code> tool.
This situation is a poignant reminder of how impossible separate compilation is in the EDA world.
A proper analogy would involve separately compiling the Verilog into some kind of low-level representation, and then linking would properly smash together those separately-compiled objects.
Instead, in Xilinx-land, “compilation” is just simple bundling and “linking” does all the compilation in one monolithic step.
It’s kind of cute that the Xilinx toolchain is pretending the world is otherwise, but it’s also kind of sad.</p>
<p>Anyway, the only way to produce a <code>.xo</code> file from RTL code appears to be to use Vivado (i.e., the actual <code>vivado</code> program).
Nothing from the newer Vitis package currently appears capable of producing <code>.xo</code> files from Verilog (although <code>v++</code> can produce these files during HLS compilation, presumably by invoking Vivado).</p>
<p>The main components in an <code>.xo</code> file, aside from the Verilog source code itself, are two XML files:
<code>kernel.xml</code>, a short file describing the argument interfaces to the hardware design,
and <code>component.xml</code>, a much longer and more complicated <a href="https://en.wikipedia.org/wiki/IP-XACT">IP-XACT</a> file that also has to do with the interface to the RTL.
We currently generate <code>kernel.xml</code> ourselves (with the <code>xilinx-xml</code> backend described above) and then use Vivado, via a Tcl script, to generate the IP-XACT file.</p>
<p>In the future, we could consider trying to route around using Vivado by generating the IP-XACT file ourselves, using a tool such as <a href="https://github.com/sifive/duh">DUH</a>.</p>
<h4 id="our-workflow"><a class="header" href="#our-workflow">Our Workflow</a></h4>
<p>The first step is to produce an <code>.xo</code> file.
We also use <a href="https://github.com/cucapra/calyx/blob/master/fud/bitstream/gen_xo.tcl">a static Tcl script, <code>gen_xo.tcl</code>,</a> which is a simplified version of <a href="https://github.com/Xilinx/Vitis-Tutorials/blob/2021.1/Hardware_Acceleration/Feature_Tutorials/01-rtl_kernel_workflow/reference-files/scripts/package_kernel.tcl">a script from Xilinx's Vitis tutorials</a>.
The gist of this script is that it creates a Vivado project, adds the source files, twiddles some settings, and then uses the <a href="https://docs.xilinx.com/r/en-US/ug1393-vitis-application-acceleration/package_xo-Command"><code>package_xo</code> command</a> to read stuff from this project as an &quot;IP directory&quot; and produce an <code>.xo</code> file.
The Vivado command line looks roughly like this:</p>
<pre><code>vivado -mode batch -source gen_xo.tcl -tclargs xclbin/kernel.xo
</code></pre>
<p>That output filename after <code>-tclargs</code>, unsurprisingly, gets passed to <a href="https://github.com/cucapra/calyx/blob/master/fud/bitstream/gen_xo.tcl"><code>gen_xo.tcl</code></a>.</p>
<p>Then, we take this <code>.xo</code> and turn it into an <a href="https://xilinx.github.io/XRT/2021.2/html/formats.html#xclbin"><code>.xclbin</code></a>.
This step uses the <code>v++</code> tool, with a command line that looks like this:</p>
<pre><code>v++ -g -t hw_emu --platform xilinx_u50_gen3x16_xdma_201920_3 --save-temps --profile.data all:all:all --profile.exec all:all:all -lo xclbin/kernel.xclbin xclbin/kernel.xo
</code></pre>
<p>Fortunately, the <code>v++</code> tool doesn't need any Tcl to drive it; all the action happens on the command line.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../fud/examples.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../fud/axi-gen.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../fud/examples.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../fud/axi-gen.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
